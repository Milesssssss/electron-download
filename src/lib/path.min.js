!function(t,e){"use strict";"function"==typeof define&&define.amd?define(["exports"],function(o){e(o),t.Path=o}):e("object"==typeof exports?exports:t.Path={})}(this,function(t){"use strict";var e=t;e.version="0.10.0",e.map=function(t){return e.routes.defined.hasOwnProperty(t)?e.routes.defined[t]:new e.core.route(t)},e.root=function(t){e.routes.root=t},e.rescue=function(t){e.routes.rescue=t},e.history={initial:{},pushState:function(t,o,i){e.history.supported?e.dispatch(i)&&history.pushState(t,o,i):e.history.fallback&&(window.location.hash="#"+i)},popState:function(){var t=!e.history.initial.popped&&location.href===e.history.initial.URL;e.history.initial.popped=!0,t||e.dispatch(document.location.pathname)},listen:function(t){if(e.history.supported=!(!window.history||!window.history.pushState),e.history.fallback=t,e.history.supported)e.history.initial.popped="state"in window.history?!0:!1,e.history.initial.URL=location.href,window.onpopstate=e.history.popState;else if(e.history.fallback){for(var o in e.routes.defined)"#"!==o.charAt(0)&&(e.routes.defined["#"+o]=e.routes.defined[o],e.routes.defined["#"+o].path="#"+o);e.listen()}}},e.match=function(t,o){var i,n,r,s,u,h={},a=null;for(a in e.routes.defined)if(null!==a&&void 0!==a)for(a=e.routes.defined[a],i=a.partition(),s=0;s<i.length;s+=1){if(n=i[s],u=t,n.search(/:/)>0)for(r=0;r<n.split("/").length;r+=1)r<u.split("/").length&&":"===n.split("/")[r].charAt(0)&&(h[n.split("/")[r].replace(/:/,"")]=u.split("/")[r],u=u.replace(u.split("/")[r],n.split("/")[r]));if(n===u)return o&&(a.params=h),a}return null},e.dispatch=function(t){var o,i;if(e.routes.current!==t){if(e.routes.previous=e.routes.current,e.routes.current=t,i=e.match(t,!0),e.routes.previous&&(o=e.match(e.routes.previous),null!==o&&null!==o.do_exit&&o.do_exit()),null!==i)return i.run(),!0;null!==e.routes.rescue&&e.routes.rescue()}},e.listen=function(){var t=function(){e.dispatch(location.hash)};""===location.hash&&null!==e.routes.root&&(location.hash=e.routes.root),"onhashchange"in window&&(!document.documentMode||document.documentMode>=8)?window.onhashchange=t:setInterval(t,50),""!==location.hash&&e.dispatch(location.hash)},e.core={route:function(t){this.path=t,this.action=null,this.do_enter=[],this.do_exit=null,this.params={},e.routes.defined[t]=this}},e.routes={current:null,root:null,rescue:null,previous:null,defined:{}},e.core.route.prototype={to:function(t){return this.action=t,this},enter:function(t){return t instanceof Array?this.do_enter=this.do_enter.concat(t):this.do_enter.push(t),this},exit:function(t){return this.do_exit=t,this},partition:function(){for(var t,e,o=[],i=[],n=/\(([^}]+?)\)/g;t=n.exec(this.path);)o.push(t[1]);for(i.push(this.path.split("(")[0]),e=0;e<o.length;e+=1)i.push(i[i.length-1]+o[e]);return i},run:function(){var t,o,i=!1;if(e.routes.defined[this.path].hasOwnProperty("do_enter")&&e.routes.defined[this.path].do_enter.length>0)for(t=0;t<e.routes.defined[this.path].do_enter.length;t+=1)if(o=e.routes.defined[this.path].do_enter[t].apply(this,null),o===!1){i=!0;break}i||e.routes.defined[this.path].action()}}});